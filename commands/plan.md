---
description: 요구사항 재진술, 위험 평가, 단계별 구현 계획 생성. 코드 작성 전 사용자 확인을 기다립니다.
---

# 계획 커맨드

이 커맨드는 **planner** 에이전트를 호출하여 코드 작성 전에 포괄적인 구현 계획을 생성합니다.

## 이 커맨드가 하는 일

1. **요구사항 재진술** - 무엇을 구축해야 하는지 명확히
2. **위험 식별** - 잠재적 문제와 차단 요소 표면화
3. **단계 계획 생성** - 구현을 단계로 분해
4. **확인 대기** - 진행 전 반드시 사용자 승인 받기

## 사용 시점

`/plan` 사용 시점:
- 새 기능 시작
- 중요한 아키텍처 변경
- 복잡한 리팩토링 작업
- 여러 파일/컴포넌트에 영향
- 요구사항이 불명확하거나 모호할 때

## 작동 방식

planner 에이전트가 수행하는 작업:

1. 요청을 **분석**하고 명확한 용어로 요구사항 재진술
2. 구체적이고 실행 가능한 단계로 **단계 분해**
3. 컴포넌트 간 **의존성 식별**
4. **위험** 및 잠재적 차단 요소 평가
5. **복잡도 추정** (높음/중간/낮음)
6. **계획 제시** 및 명시적 확인 대기

## 사용 예시

```
사용자: /plan 마켓이 해결될 때 실시간 알림을 추가해야 합니다

에이전트 (planner):
# 구현 계획: 실시간 마켓 해결 알림

## 요구사항 재진술
- 사용자가 지켜보는 마켓이 해결될 때 알림 전송
- 여러 알림 채널 지원 (인앱, 이메일, 웹훅)
- 알림이 안정적으로 전달되도록 보장
- 마켓 결과와 사용자의 포지션 결과 포함

## 구현 단계

### 1단계: 데이터베이스 스키마
- 알림 테이블 추가: id, user_id, market_id, type, status, created_at
- 채널 선호도를 위한 user_notification_preferences 테이블 추가
- 성능을 위해 user_id와 market_id에 인덱스 생성

### 2단계: 알림 서비스
- lib/notifications.ts에 알림 서비스 생성
- BullMQ/Redis로 알림 큐 구현
- 실패한 전달에 재시도 로직 추가
- 알림 템플릿 생성

### 3단계: 통합 지점
- 마켓 해결 로직에 훅 (상태가 "resolved"로 변경될 때)
- 마켓에 포지션이 있는 모든 사용자 쿼리
- 각 사용자에 대해 알림 큐에 추가

### 4단계: 프론트엔드 컴포넌트
- 헤더에 NotificationBell 컴포넌트 생성
- NotificationList 모달 추가
- Supabase 구독으로 실시간 업데이트 구현
- 알림 설정 페이지 추가

## 의존성
- Redis (큐용)
- 이메일 서비스 (SendGrid/Resend)
- Supabase 실시간 구독

## 위험
- 높음: 이메일 전달 가능성 (SPF/DKIM 필요)
- 중간: 마켓당 1000+ 사용자 시 성능
- 중간: 마켓이 자주 해결되면 알림 스팸
- 낮음: 실시간 구독 오버헤드

## 예상 복잡도: 중간
- 백엔드: 4-6시간
- 프론트엔드: 3-4시간
- 테스팅: 2-3시간
- 총: 9-13시간

**확인 대기 중**: 이 계획으로 진행할까요? (예/아니오/수정)
```

## 중요 참고사항

**치명적**: planner 에이전트는 "예" 또는 "진행" 또는 유사한 긍정적 응답으로 명시적으로 계획을 확인할 때까지 코드를 작성하지 **않습니다**.

변경을 원하면 다음으로 응답:
- "수정: [변경 내용]"
- "다른 접근 방식: [대안]"
- "2단계 건너뛰고 3단계 먼저"

## 다른 커맨드와의 통합

계획 후:
- `/tdd`를 사용하여 테스트 주도 개발로 구현
- `/build-and-fix`를 사용하여 빌드 오류 발생 시
- `/code-review`를 사용하여 완료된 구현 검토

## 관련 에이전트

이 커맨드는 다음 에이전트를 호출합니다:
`~/.claude/agents/planner.md`
